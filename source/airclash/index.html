<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>è¡—æœºé£æœºå¤§æˆ˜ - è°ƒæ•´ç§»åŠ¨çµæ•åº¦</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:black;overflow:hidden;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
#gameCanvas{display:block;}
.controls{position:absolute;top:10px;right:10px;z-index:1000;}
.button{cursor:pointer;color:#ffcc00;font-size:1.5rem;margin-left:10px;}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div class="controls">
<span id="soundToggle" class="button">ğŸ”Š</span>
<span id="musicToggle" class="button">ğŸµ</span>
</div>
<script>
// å…¨å± Canvas
const canvas=document.getElementById('gameCanvas');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
const ctx=canvas.getContext('2d');
window.addEventListener('resize',()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

// æ§åˆ¶
const soundToggle=document.getElementById('soundToggle');
const musicToggle=document.getElementById('musicToggle');
let soundOn=true,musicOn=true;

// èƒŒæ™¯éŸ³ä¹
const bgMusic=new Audio();
bgMusic.src='https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
bgMusic.loop=true; bgMusic.volume=0.3; if(musicOn) bgMusic.play();

// ç©å®¶
const player={
    x:canvas.width/2-25,
    y:canvas.height-80,
    width:50,
    height:50,
    speed:4, // é™ä½ç§»åŠ¨çµæ•åº¦
    lives:3,
    shield:false,
    weapon:1
};
let bullets=[],enemies=[],enemyBullets=[],particles=[],items=[],score=0,level=1,combo=0,lastHitTime=0;
let lastEnemy=0,lastItem=0,lastBoss=0;

// éŸ³æ•ˆ
function playSound(type){if(!soundOn) return;
const ctxAudio=new (window.AudioContext||window.webkitAudioContext)();
const osc=ctxAudio.createOscillator();const gain=ctxAudio.createGain();osc.connect(gain);gain.connect(ctxAudio.destination);
gain.gain.setValueAtTime(0.1,ctxAudio.currentTime);
switch(type){case"shoot":osc.type="square";osc.frequency.setValueAtTime(880,ctxAudio.currentTime);break;
case"explosion":osc.type="sawtooth";osc.frequency.setValueAtTime(200,ctxAudio.currentTime);break;
case"item":osc.type="triangle";osc.frequency.setValueAtTime(440,ctxAudio.currentTime);break;
case"boss":osc.type="sine";osc.frequency.setValueAtTime(120,ctxAudio.currentTime);break;}
gain.gain.exponentialRampToValueAtTime(0.001,ctxAudio.currentTime+0.15);osc.start();osc.stop(ctxAudio.currentTime+0.1);}

// ç±»
class Bullet{constructor(x,y,angle=0){this.x=x;this.y=y;this.width=6;this.height=12;this.speed=10;this.angle=angle;}
update(){this.x+=Math.sin(this.angle)*5; this.y-=this.speed; particles.push(new Particle(this.x+3,this.y+6,"#0f0",2));}
draw(){ctx.fillStyle="#4CAF50";ctx.fillRect(this.x,this.y,this.width,this.height);}}

class Enemy{constructor(x,y,type=0){this.x=x;this.y=y;this.width=40;this.height=40;this.speed=2+type;this.hp=type>0?type*10:1;this.type=type;this.shootTimer=0;}
update(delta){this.y+=this.speed;if(this.type>0){this.shootTimer+=delta;if(this.shootTimer>1200){enemyBullets.push(new EnemyBullet(this.x+this.width/2,this.y+this.height));this.shootTimer=0;playSound("shoot");}}}
draw(){ctx.fillStyle=this.type>0?"#FFAA00":"#FF5252";ctx.fillRect(this.x,this.y,this.width,this.height);}}

class EnemyBullet{constructor(x,y,angle=0){this.x=x;this.y=y;this.width=6;this.height=12;this.speed=5;this.angle=angle;}
update(){this.x+=Math.sin(this.angle)*3; this.y+=this.speed;} draw(){ctx.fillStyle="#FF0000";ctx.fillRect(this.x,this.y,this.width,this.height);}}

class Item{constructor(x,y,type){this.x=x;this.y=y;this.width=25;this.height=25;this.speed=3;this.type=type;}
update(){this.y+=this.speed;} draw(){ctx.fillStyle=this.type===1?"#00FFFF":"#FF00FF";ctx.fillRect(this.x,this.y,this.width,this.height);}}

class Particle{constructor(x,y,color,size){this.x=x;this.y=y;this.vx=(Math.random()-0.5)*4;this.vy=(Math.random()-0.5)*4;this.size=size||Math.random()*4+2;this.alpha=1;this.color=color;}
update(){this.x+=this.vx;this.y+=this.vy;this.alpha-=0.05;}
draw(){if(this.alpha<=0)return;ctx.save();ctx.globalAlpha=this.alpha;ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.restore();}}

function spawnParticles(x,y,color,count){for(let i=0;i<count;i++)particles.push(new Particle(x,y,color));}
function shoot(){switch(player.weapon){case 1: bullets.push(new Bullet(player.x+player.width/2-3,player.y));break;
case 2: bullets.push(new Bullet(player.x+5,player.y)); bullets.push(new Bullet(player.x+player.width-11,player.y));break;
case 3: bullets.push(new Bullet(player.x+player.width/2-3,player.y,-0.3)); bullets.push(new Bullet(player.x+player.width/2-3,player.y,0)); bullets.push(new Bullet(player.x+player.width/2-3,player.y,0.3));break;
case 4: bullets.push(new Bullet(player.x,player.y,-0.2)); bullets.push(new Bullet(player.x+player.width/2-3,player.y,0)); bullets.push(new Bullet(player.x+player.width-6,player.y,0.2));break;} playSound("shoot");}

// é”®ç›˜
let keys={};
document.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;});
document.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false;});

// æ‰‹æœºè§¦æ§
const isTouchDevice='ontouchstart' in window||window.matchMedia("(pointer: coarse)").matches;
if(isTouchDevice){
    canvas.addEventListener('touchstart',e=>{player.x=e.touches[0].clientX-player.width/2; player.y=e.touches[0].clientY-player.height/2; shoot();},{passive:true});
    canvas.addEventListener('touchmove',e=>{e.preventDefault();
        const targetX=e.touches[0].clientX-player.width/2;
        const targetY=e.touches[0].clientY-player.height/2;
        player.x += (targetX - player.x) * 0.2; // ç¼“åŠ¨ç³»æ•°0.2
        player.y += (targetY - player.y) * 0.2;
    },{passive:false});
}

// ç”Ÿæˆ
function spawnEnemy(){enemies.push(new Enemy(Math.random()*(canvas.width-40),-40,Math.random()<0.2?2:0));}
function spawnItem(){items.push(new Item(Math.random()*(canvas.width-25),-25,Math.random()<0.5?1:2));}
function spawnBoss(){enemies.push(new Enemy(canvas.width/2-50,-100,5)); playSound("boss");}

// æ›´æ–°
function update(delta){
    if(!isTouchDevice){if(keys['arrowleft']||keys['a']) player.x-=player.speed;
    if(keys['arrowright']||keys['d']) player.x+=player.speed;if(keys['arrowup']||keys['w']) player.y-=player.speed;
    if(keys['arrowdown']||keys['s']) player.y+=player.speed;if(keys[' ']){if(!keys.shoot){shoot(); keys.shoot=true;}}else keys.shoot=false;}
    player.x=Math.max(0,Math.min(canvas.width-player.width,player.x));
    player.y=Math.max(0,Math.min(canvas.height-player.height,player.y));

    bullets.forEach((b,i)=>{b.update(); if(b.y<0||b.x<0||b.x>canvas.width) bullets.splice(i,1);});
    enemyBullets.forEach((eb,i)=>{eb.update(); if(eb.y>canvas.height||eb.x<0||eb.x>canvas.width) enemyBullets.splice(i,1);});

    enemies.forEach((e,ei)=>{
        e.update(delta);
        bullets.forEach((b,bi)=>{if(b.x<b.x+b.width&&b.x+b.width>e.x&&b.y<b.y+b.height&&b.y+b.height>e.y){e.hp--; spawnParticles(e.x+e.width/2,e.y+e.height/2,"#FFEA00",5); if(e.hp<=0){playSound("explosion");enemies.splice(ei,1); score+=10; combo++; lastHitTime=Date.now();} bullets.splice(bi,1);}});
        if(player.x<e.x+e.width&&player.x+player.width>e.x&&player.y<e.y+e.height&&player.y+player.height>e.y){if(!player.shield){spawnParticles(player.x+player.width/2,player.y+player.height/2,"#FF5252",12);player.lives--; playSound("explosion"); if(player.lives<=0){alert("æ¸¸æˆç»“æŸ! å¾—åˆ†:"+score);initGame();}}}
        if(e.y>canvas.height) enemies.splice(ei,1);
    });

    enemyBullets.forEach((eb,ebi)=>{if(player.x<eb.x+eb.width&&player.x+player.width>eb.x&&player.y<eb.y+eb.height&&player.y+player.height>eb.y){if(!player.shield){spawnParticles(player.x+player.width/2,player.y+player.height/2,"#FF0000",10);player.lives--; playSound("explosion"); enemyBullets.splice(ebi,1); if(player.lives<=0){alert("æ¸¸æˆç»“æŸ! å¾—åˆ†:"+score);initGame();}}else{enemyBullets.splice(ebi,1);}}});

    items.forEach((it,ii)=>{it.update(); if(player.x<it.x+it.width&&player.x+player.width>it.x&&player.y<it.y+it.height&&player.y+player.height>it.y){playSound("item"); if(it.type===1){score+=50; combo+=1;} else{player.lives=Math.min(player.lives+1,5);} items.splice(ii,1);} if(it.y>canvas.height) items.splice(ii,1);});

    particles.forEach((p,i)=>{p.update(); if(p.alpha<=0) particles.splice(i,1);});

    if(Date.now()-lastHitTime>2000) combo=0;

    if(Date.now()-lastEnemy>1000/level){lastEnemy=Date.now(); spawnEnemy();}
    if(Date.now()-lastItem>5000){lastItem=Date.now(); spawnItem();}
    if(Date.now()-lastBoss>20000){lastBoss=Date.now(); spawnBoss();}
    if(score>level*200) level++;
}

// ç»˜åˆ¶
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // èƒŒæ™¯
    for(let i=0;i<canvas.height;i+=20){ctx.strokeStyle='rgba(255,255,255,0.05)'; ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke();}
    if(Math.random()<0.02){ctx.strokeStyle="rgba(255,255,255,0.3)";ctx.beginPath();ctx.moveTo(Math.random()*canvas.width,0); ctx.lineTo(Math.random()*canvas.width,canvas.height);ctx.stroke();}

    // ç©å®¶
    ctx.fillStyle="#4CAF50"; ctx.fillRect(player.x,player.y,player.width,player.height);

    // å­å¼¹
    bullets.forEach(b=>b.draw()); enemyBullets.forEach(eb=>eb.draw());
    // æ•Œäºº
    enemies.forEach(e=>e.draw());
    // é“å…·
    items.forEach(it=>it.draw());
    // ç²’å­
    particles.forEach(p=>p.draw());
    // åˆ†æ•°/ç”Ÿå‘½/å…³å¡/è¿å‡»
    ctx.fillStyle="#fff"; ctx.font="18px Arial";
    ctx.fillText("Score: "+score,10,25);
    ctx.fillText("Lives: "+player.lives,10,50);
    ctx.fillText("Level: "+level,10,75);
    if(combo>1) ctx.fillText("Combo x"+combo,10,100);
}

// ä¸»å¾ªç¯
let lastTime=0;
function gameLoop(time){
    const delta=time-lastTime; lastTime=time;
    update(delta); draw(); requestAnimationFrame(gameLoop);
}

function initGame(){player.x=canvas.width/2-25; player.y=canvas.height-80; bullets=[]; enemies=[]; enemyBullets=[]; particles=[]; items=[]; score=0; player.lives=3; player.shield=false; player.weapon=1; level=1; combo=0; lastEnemy=0; lastItem=0; lastBoss=0; lastHitTime=0; if(musicOn) bgMusic.play(); requestAnimationFrame(gameLoop);}

// éŸ³ä¹/éŸ³æ•ˆåˆ‡æ¢
soundToggle.addEventListener('click',()=>{soundOn=!soundOn; soundToggle.innerHTML=soundOn?'ğŸ”Š':'ğŸ”ˆ';});
musicToggle.addEventListener('click',()=>{musicOn=!musicOn; if(musicOn) bgMusic.play(); else bgMusic.pause(); musicToggle.innerHTML=musicOn?'ğŸµ':'ğŸ”‡';});

initGame();
</script>
</body>
</html>
