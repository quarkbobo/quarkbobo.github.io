<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 Ê∏∏Êàè</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);color:white;padding:20px;}
.container{max-width:500px;width:100%;background:rgba(0,0,0,0.75);border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center;position:relative;}
.container h1{font-size:2rem;margin-bottom:15px;color:#ffcc00;text-shadow:0 2px 5px rgba(0,0,0,0.3);}
#scoreBox{font-size:1.3rem;margin-bottom:10px;color:#4CAF50;}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:15px;}
.cell{width:70px;height:70px;border-radius:10px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:bold;color:#fff;transition:all 0.2s;}
.cell-2{background:#eee4da;color:#776e65;}
.cell-4{background:#ede0c8;color:#776e65;}
.cell-8{background:#f2b179;}
.cell-16{background:#f59563;}
.cell-32{background:#f67c5f;}
.cell-64{background:#f65e3b;}
.cell-128{background:#edcf72;color:#f9f6f2;}
.cell-256{background:#edcc61;color:#f9f6f2;}
.cell-512{background:#edc850;color:#f9f6f2;}
.cell-1024{background:#edc53f;color:#f9f6f2;}
.cell-2048{background:#edc22e;color:#f9f6f2;}
.sound-toggle{position:absolute;top:15px;right:20px;font-size:1.5rem;cursor:pointer;color:#ffcc00;transition:transform 0.3s;}
.sound-toggle:hover{transform:scale(1.2);}
@media(max-width:500px){.container{padding:15px;}.cell{width:60px;height:60px;font-size:1.2rem;}}
</style>
</head>
<body>
<div class="container">
<h1>2048 Ê∏∏Êàè</h1>
<div id="scoreBox">ÂàÜÊï∞: 0</div>
<div class="grid" id="grid"></div>
<div class="sound-toggle" id="soundToggle">üîä</div>
</div>
<script>
(() => {
  const G = document.getElementById("grid");
  const S = document.getElementById("scoreBox");
  const T = document.getElementById("soundToggle");
  let score = 0;
  let soundOn = true;
  let board = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];

  function playSound(type){
    if(!soundOn) return;
    const ctx = new(window.AudioContext||window.webkitAudioContext)();
    const g = ctx.createGain();
    const osc = ctx.createOscillator();
    osc.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(.1,ctx.currentTime);
    if(type==="merge"){ osc.type="triangle"; osc.frequency.setValueAtTime(440,ctx.currentTime); osc.frequency.exponentialRampToValueAtTime(880,ctx.currentTime+.1);}
    else{ osc.type="sine"; osc.frequency.setValueAtTime(220,ctx.currentTime); osc.frequency.exponentialRampToValueAtTime(110,ctx.currentTime+.2);}
    osc.start(); osc.stop(ctx.currentTime+.15);
  }

  function updateGrid(){
    G.innerHTML="";
    for(let i=0;i<4;i++)for(let j=0;j<4;j++){
      const val=board[i][j];
      const c=document.createElement("div");
      c.classList.add("cell");
      val&&c.classList.add("cell-"+val);
      c.textContent = val || "";
      G.appendChild(c);
    }
    S.textContent = "ÂàÜÊï∞: "+score;
  }

  function emptyCells(){
    const cells=[];
    for(let i=0;i<4;i++)for(let j=0;j<4;j++)if(board[i][j]===0)cells.push([i,j]);
    return cells;
  }

  function addRandom(){
    const empty = emptyCells();
    if(empty.length===0) return;
    const [i,j]=empty[Math.floor(Math.random()*empty.length)];
    board[i][j] = Math.random()<0.9 ? 2 : 4;
  }

  function rotateLeft(m){return m[0].map((x,i)=>m.map(row=>row[i])).reverse();}
  function slide(row){
    let arr=row.filter(v=>v!==0),points=0;
    for(let i=0;i<arr.length-1;i++){
      if(arr[i]===arr[i+1]){arr[i]*=2;points+=arr[i];arr[i+1]=0; playSound("merge");}
    }
    arr = arr.filter(v=>v!==0); while(arr.length<4) arr.push(0);
    return [arr, points];
  }

  function move(dir){
    let points=0;
    let b = board.map(r=>r.slice());
    for(let k=0;k<dir;k++) b = rotateLeft(b);
    for(let i=0;i<4;i++){ const [newRow,p]=slide(b[i]); b[i]=newRow; points+=p;}
    for(let k=0;k<(4-dir)%4;k++) b = rotateLeft(b);
    if(JSON.stringify(b)!==JSON.stringify(board)){board=b;score+=points;points>0&&playSound("merge");addRandom();updateGrid();}
  }

  function keyHandler(e){
    switch(e.key){
      case"ArrowUp":case"W":move(0);break;
      case"ArrowRight":case"D":move(1);break;
      case"ArrowDown":case"S":move(2);break;
      case"ArrowLeft":case"A":move(3);break;
    }
  }

  function touchHandler(){
    let xStart=0,yStart=0;
    G.addEventListener("touchstart",t=>{xStart=t.touches[0].clientX;yStart=t.touches[0].clientY;},{passive:true});
    G.addEventListener("touchend",t=>{
      const dx=t.changedTouches[0].clientX-xStart;
      const dy=t.changedTouches[0].clientY-yStart;
      if(Math.abs(dx)>Math.abs(dy)){ dx>0?move(1):move(3); }
      else{ dy>0?move(2):move(0); }
    },{passive:true});
  }

  function init(){
    board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
    score=0;
    addRandom(); addRandom();
    updateGrid();
  }

  document.addEventListener("keydown", keyHandler);
  T.addEventListener("click", ()=>{soundOn=!soundOn;T.innerHTML=soundOn?"üîä":"üîà";});
  touchHandler();
  init();
})();
</script>
</body>
</html>
