<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>2048 ç²’å­ç‚«å½©ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);color:white;padding:10px;}
.container{max-width:500px;width:100%;background:rgba(0,0,0,0.7);border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center;position:relative;}
h1{font-size:2rem;margin-bottom:15px;color:#ffcc00;text-shadow:0 2px 5px rgba(0,0,0,0.3);}
#gameBoard{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:10px;background:rgba(255,255,255,0.1);padding:10px;border-radius:10px;}
.tile{width:70px;height:70px;font-size:1.5rem;display:flex;align-items:center;justify-content:center;border-radius:8px;font-weight:bold;transition:all 0.2s;position:relative;box-shadow:0 2px 5px rgba(0,0,0,0.3);}
.tile-2{background:#eee4da;color:#776e65;}
.tile-4{background:#ede0c8;color:#776e65;}
.tile-8{background:#f2b179;color:#f9f6f2;}
.tile-16{background:#f59563;color:#f9f6f2;}
.tile-32{background:#f67c5f;color:#f9f6f2;}
.tile-64{background:#f65e3b;color:#f9f6f2;}
.tile-128{background:#edcf72;color:#f9f6f2;}
.tile-256{background:#edcc61;color:#f9f6f2;}
.tile-512{background:#edc850;color:#f9f6f2;}
.tile-1024{background:#edc53f;color:#f9f6f2;}
.tile-2048{background:#edc22e;color:#f9f6f2;}
.controls{margin-top:10px;}
.controls button{padding:8px 15px;font-size:1rem;background:#4CAF50;color:white;border:none;border-radius:5px;cursor:pointer;transition:all 0.3s;margin-left:5px;}
.controls button:hover{background:#45a049;transform:translateY(-2px);}
.sound-toggle{position:absolute;top:15px;right:20px;font-size:1.5rem;cursor:pointer;color:#ffcc00;transition:transform 0.3s;}
.sound-toggle:hover{transform:scale(1.2);}
.score{margin:10px 0;font-size:1.5rem;color:#4CAF50;}
@media(max-width:400px){.tile{width:60px;height:60px;font-size:1.2rem;} h1{font-size:1.5rem;} .score{font-size:1.2rem;}}
</style>
</head>
<body>
<div class="container">
<h1>2048 ç²’å­ç‚«å½©ç‰ˆ</h1>
<div class="score" id="score">åˆ†æ•°: 0</div>
<div id="gameBoard"></div>
<div class="controls">
<button id="restartBtn">é‡æ–°å¼€å§‹</button>
</div>
<div class="sound-toggle" id="soundToggle">ğŸ”Š</div>
</div>

<script>
const boardSize=4;
let board=[],score=0,soundOn=true,particles=[];
const boardEl=document.getElementById('gameBoard');
const scoreEl=document.getElementById('score');
const restartBtn=document.getElementById('restartBtn');
const soundToggle=document.getElementById('soundToggle');

function playSound(type){
    if(!soundOn) return;
    const ctxAudio=new (window.AudioContext||window.webkitAudioContext)();
    const osc=ctxAudio.createOscillator();
    const gain=ctxAudio.createGain();
    osc.connect(gain); gain.connect(ctxAudio.destination);
    gain.gain.setValueAtTime(0.15, ctxAudio.currentTime);
    if(type==="merge"){osc.type="triangle";osc.frequency.setValueAtTime(440+score,ctxAudio.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, ctxAudio.currentTime+0.12);}
    if(type==="move"){osc.type="sine";osc.frequency.setValueAtTime(220,ctxAudio.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, ctxAudio.currentTime+0.08);}
    osc.start(); osc.stop(ctxAudio.currentTime+0.12);
}

function initBoard(){
    board=new Array(boardSize).fill(0).map(()=>new Array(boardSize).fill(0));
    score=0; updateScore(); addRandomTile(); addRandomTile(); renderBoard();
}

function updateScore(){scoreEl.textContent='åˆ†æ•°: '+score;}

function addRandomTile(){
    let empty=[];
    for(let i=0;i<boardSize;i++) for(let j=0;j<boardSize;j++) if(board[i][j]===0) empty.push([i,j]);
    if(empty.length===0) return;
    const [x,y]=empty[Math.floor(Math.random()*empty.length)];
    board[x][y]=Math.random()<0.9?2:4;
}

function renderBoard(){
    boardEl.innerHTML='';
    for(let i=0;i<boardSize;i++){
        for(let j=0;j<boardSize;j++){
            const val=board[i][j];
            const div=document.createElement('div');
            div.className='tile'+(val>0?` tile-${val}`:'');
            div.textContent=val>0?val:'';
            boardEl.appendChild(div);
        }
    }
}

function slide(row){
    let arr=row.filter(v=>v!==0);
    for(let i=0;i<arr.length-1;i++){
        if(arr[i]===arr[i+1]){arr[i]*=2;score+=arr[i];playSound("merge"); arr[i+1]=0;}
    }
    arr=arr.filter(v=>v!==0);
    while(arr.length<boardSize) arr.push(0);
    return arr;
}

function move(dir){
    let moved=false;
    if(dir==='left'||dir==='right'){
        for(let i=0;i<boardSize;i++){
            let row=dir==='left'?board[i]:board[i].slice().reverse();
            const newRow=slide(row);
            if(dir==='right') newRow.reverse();
            if(JSON.stringify(board[i])!==JSON.stringify(newRow)){moved=true; board[i]=newRow;}
        }
    } else {
        for(let j=0;j<boardSize;j++){
            let col=[]; for(let i=0;i<boardSize;i++) col.push(board[i][j]);
            if(dir==='down') col.reverse();
            const newCol=slide(col);
            if(dir==='down') newCol.reverse();
            for(let i=0;i<boardSize;i++) if(board[i][j]!==newCol[i]){moved=true; board[i][j]=newCol[i];}
        }
    }
    if(moved){addRandomTile(); playSound("move"); renderBoard(); updateScore();}
}

document.addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    switch(k){
        case 'arrowup': case 'w': move('up'); break;
        case 'arrowdown': case 's': move('down'); break;
        case 'arrowleft': case 'a': move('left'); break;
        case 'arrowright': case 'd': move('right'); break;
    }
});

const isTouchDevice = 'ontouchstart' in window || window.matchMedia("(pointer: coarse)").matches;
let startX=0,startY=0,threshold=30;
if(isTouchDevice){
    boardEl.addEventListener('touchstart',e=>{startX=e.touches[0].clientX; startY=e.touches[0].clientY;},{passive:true});
    boardEl.addEventListener('touchmove',e=>{e.preventDefault();},{passive:false});
    boardEl.addEventListener('touchend',e=>{
        const dx=e.changedTouches[0].clientX-startX;
        const dy=e.changedTouches[0].clientY-startY;
        if(Math.abs(dx)<threshold && Math.abs(dy)<threshold) return;
        if(Math.abs(dx)>Math.abs(dy)) dx>0?move('right'):move('left');
        else dy>0?move('down'):move('up');
    },{passive:false});
}

restartBtn.addEventListener('click',initBoard);
soundToggle.addEventListener('click',()=>{soundOn=!soundOn;soundToggle.innerHTML=soundOn?'ğŸ”Š':'ğŸ”ˆ';});

initBoard();
</script>
</body>
</html>
