<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>è´ªåƒè›‡ CTF</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;
      background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);color:white;padding:10px;}
.container{max-width:800px;width:100%;background:rgba(0,0,0,0.7);border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center;position:relative;}
h1{font-size:2rem;margin-bottom:15px;color:#ffcc00;text-shadow:0 2px 5px rgba(0,0,0,0.3);}
.game-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px;background:rgba(255,255,255,0.1);border-radius:10px;}
#score{font-size:1.5rem;font-weight:bold;color:#4CAF50;}
.controls button{padding:8px 15px;font-size:1rem;background:#4CAF50;color:white;border:none;border-radius:5px;cursor:pointer;transition:all 0.3s;}
.controls button:hover{background:#45a049;transform:translateY(-2px);}
#gameCanvas{border:3px solid #4CAF50;border-radius:10px;background-color:#0a1929;margin-bottom:10px;width:100%;max-width:600px;height:auto;}
.instructions{background:rgba(255,255,255,0.1);padding:10px;border-radius:10px;margin-bottom:10px;text-align:left;}
.instructions h2{color:#ffcc00;margin-bottom:5px;}
.instructions ul{list-style:none;padding-left:15px;}
.instructions li{margin-bottom:5px;position:relative;padding-left:20px;}
.instructions li:before{content:"â–¶";position:absolute;left:0;color:#4CAF50;}
.victory-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;justify-content:center;align-items:center;}
.victory-content{background:linear-gradient(135deg,#1a2a6c,#b21f1f);padding:30px;border-radius:15px;text-align:center;max-width:400px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.5);animation:pulse 2s infinite;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
.victory-content h2{font-size:2rem;margin-bottom:15px;color:#ffcc00;}
.victory-content .flag{font-family:monospace;font-size:1.5rem;background:rgba(0,0,0,0.3);padding:10px;border-radius:10px;color:#ffcc00;margin:10px 0;}
#closeVictoryBtn{background:#4CAF50;color:white;border:none;border-radius:5px;padding:6px 12px;cursor:pointer;margin-top:10px;}
#closeVictoryBtn:hover{background:#45a049;}
.sound-toggle{position:absolute;top:15px;right:20px;font-size:1.5rem;cursor:pointer;color:#ffcc00;transition:transform 0.3s;}
.sound-toggle:hover{transform:scale(1.2);}
@media(max-width:500px){h1{font-size:1.5rem;} .instructions{font-size:0.9rem;} #score{font-size:1.2rem;}}
</style>
</head>
<body>
<div class="container">
<h1>è´ªåƒè›‡ CTF</h1>
<div class="game-info">
<div id="score">å¾—åˆ†: 0</div>
<div class="controls">
<button id="startBtn">å¼€å§‹</button>
<button id="pauseBtn">æš‚åœ</button>
<button id="restartBtn">é‡ç½®</button>
</div>
</div>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<div class="instructions">
<h2>è¯´æ˜</h2>
<ul>
<li>æ–¹å‘æ§åˆ¶ï¼šé”®ç›˜ WASD / â†‘â†“â†â†’ æˆ–æ‰‹æœºæ»‘åŠ¨</li>
<li>åƒåˆ°çº¢è‰²é£Ÿç‰© +10åˆ†</li>
<li>è·å–flagåªéœ€è¦10000åˆ†</li>
</ul>
</div>
<div class="sound-toggle" id="soundToggle">ğŸ”Š</div>
</div>

<div class="victory-modal" id="victoryModal">
<div class="victory-content">
<h2>ğŸ‰ FLAG è§£é”!</h2>
<div id="flagBox" class="flag"></div>
<button id="closeVictoryBtn">å…³é—­</button>
</div>
</div>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const scoreEl=document.getElementById('score');
const startBtn=document.getElementById('startBtn');
const pauseBtn=document.getElementById('pauseBtn');
const restartBtn=document.getElementById('restartBtn');
const victoryModal=document.getElementById('victoryModal');
const flagBox=document.getElementById('flagBox');
const closeVictoryBtn=document.getElementById('closeVictoryBtn');
const soundToggle=document.getElementById('soundToggle');

const gridSize=20,gameSpeed=150,WIN_SCORE=10000;
let snake=[],direction={x:1,y:0},food={x:0,y:0},score=0,gameLoop,isGameOver=false,isPaused=false,soundOn=true,foodBlinkCounter=0;

function playSound(type){
    if(!soundOn) return;
    const ctxAudio=new (window.AudioContext||window.webkitAudioContext)();
    const osc=ctxAudio.createOscillator();
    const gain=ctxAudio.createGain();
    osc.connect(gain); gain.connect(ctxAudio.destination);
    gain.gain.setValueAtTime(0.15, ctxAudio.currentTime);
    if(type==="eat"){osc.type="triangle";osc.frequency.setValueAtTime(880,ctxAudio.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, ctxAudio.currentTime+0.15);}
    if(type==="fail"){osc.type="sine";osc.frequency.setValueAtTime(220,ctxAudio.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, ctxAudio.currentTime+0.2);}
    osc.start(); osc.stop(ctxAudio.currentTime+0.15);
}

function initGame(){
    snake=[{x:10,y:10},{x:9,y:10},{x:8,y:10}];
    direction={x:1,y:0}; score=0; updateScore();
    generateFood(); isGameOver=false; isPaused=false;
    victoryModal.style.display='none';
    if(gameLoop) clearInterval(gameLoop);
    gameLoop=setInterval(update,gameSpeed);
    draw();
}

function generateFood(){
    food={x:Math.floor(Math.random()*(canvas.width/gridSize)),y:Math.floor(Math.random()*(canvas.height/gridSize))};
    while(snake.some(s=>s.x===food.x&&s.y===food.y)) generateFood();
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle='rgba(255,255,255,0.05)';
    for(let x=0;x<canvas.width;x+=gridSize){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);ctx.stroke();}
    for(let y=0;y<canvas.height;y+=gridSize){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);ctx.stroke();}
    snake.forEach((seg,i)=>{ctx.fillStyle=i===0?'#4CAF50':'#8BC34A';ctx.fillRect(seg.x*gridSize,seg.y*gridSize,gridSize,gridSize);ctx.strokeStyle='#388E3C';ctx.strokeRect(seg.x*gridSize,seg.y*gridSize,gridSize,gridSize);});
    
    // é£Ÿç‰©é—ªçƒåŠ¨ç”»
    foodBlinkCounter++;
    const blink=Math.sin(foodBlinkCounter*0.3)>0;
    ctx.fillStyle=blink?'#FF5252':'#FFAAAA';
    ctx.beginPath();
    ctx.arc(food.x*gridSize+gridSize/2,food.y*gridSize+gridSize/2,gridSize/2-1,0,Math.PI*2);
    ctx.fill();

    if(isGameOver){ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='white';ctx.font='30px Arial';ctx.textAlign='center';ctx.fillText('æ¸¸æˆç»“æŸ',canvas.width/2,canvas.height/2);}
    if(isPaused&&!isGameOver){ctx.fillStyle='rgba(0,0,0,0.5)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='white';ctx.font='30px Arial';ctx.textAlign='center';ctx.fillText('æš‚åœ',canvas.width/2,canvas.height/2);}
}

function update(){
    if(isGameOver||isPaused) return;
    const head={x:snake[0].x+direction.x,y:snake[0].y+direction.y};
    if(head.x<0||head.x>=canvas.width/gridSize||head.y<0||head.y>=canvas.height/gridSize||snake.some(s=>s.x===head.x&&s.y===head.y)){
        isGameOver=true; playSound("fail"); draw(); return;
    }
    snake.unshift(head);
    if(head.x===food.x&&head.y===food.y){score+=10; playSound("eat"); updateScore(); generateFood();}
    else snake.pop();
    draw();
}

function updateScore(){scoreEl.textContent='å¾—åˆ†: '+score;}

const isMobile=/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if(!isMobile){
    document.addEventListener('keydown',e=>{const k=e.key.toLowerCase();switch(k){case'arrowup':case'w':if(direction.y===0)direction={x:0,y:-1};break;case'arrowdown':case's':if(direction.y===0)direction={x:0,y:1};break;case'arrowleft':case'a':if(direction.x===0)direction={x:-1,y:0};break;case'arrowright':case'd':if(direction.x===0)direction={x:1,y:0};break;case' ':togglePause();break;}});
}else{
    let startX=0,startY=0,threshold=10;
    canvas.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;startY=e.touches[0].clientY;},{passive:true});
    canvas.addEventListener('touchmove',e=>{e.stopPropagation();},{passive:true});
    canvas.addEventListener('touchend',e=>{
        const dx=e.changedTouches[0].clientX-startX,dy=e.changedTouches[0].clientY-startY;
        if(Math.abs(dx)<threshold&&Math.abs(dy)<threshold) return;
        if(Math.abs(dx)>Math.abs(dy)){dx>0?direction.x===0&&(direction={x:1,y:0}):direction.x===0&&(direction={x:-1,y:0});}
        else{dy>0?direction.y===0&&(direction={x:0,y:1}):direction.y===0&&(direction={x:0,y:-1});}
    },{passive:true});
}

startBtn.addEventListener('click',()=>{if(isPaused)togglePause();else if(isGameOver)initGame();});
pauseBtn.addEventListener('click',togglePause);
restartBtn.addEventListener('click',initGame);
closeVictoryBtn.addEventListener('click',()=>{victoryModal.style.display='none';});
soundToggle.addEventListener('click',()=>{soundOn=!soundOn;soundToggle.innerHTML=soundOn?'ğŸ”Š':'ğŸ”ˆ';});

function togglePause(){if(!isGameOver){isPaused=!isPaused;draw();}}

// CTF console
window.setScore=function(s){score=s; updateScore(); console.log('%cscore set to '+s,'color:#4caf50'); if(score>=WIN_SCORE){victoryModal.style.display='flex'; flagBox.textContent='flag{y0u_r_a_wEber}';}}
window.getFlag=function(){if(score>=WIN_SCORE){victoryModal.style.display='flex'; flagBox.textContent='flag{y0u_r_a_wEber}';}else console.log('%cåˆ†æ•°ä¸è¶³','color:#ff9800');}

initGame();
console.log("è´ªåƒè›‡ CTF Challenge","color:#4caf50;font-size:16px;");
</script>
</body>
</html>
