/* snake.js (obfuscated CTF build) */
(()=>{const g=document,q=g.getElementById("gameCanvas"),y=q.getContext("2d"),Y=g.getElementById("score"),C=g.getElementById("startBtn"),Z=g.getElementById("pauseBtn"),N=g.getElementById("restartBtn"),S=g.getElementById("victoryModal"),O=g.getElementById("closeVictoryBtn"),A=g.getElementById("flagBox"),X=g.createElement("div");X.className="sound-toggle",X.innerHTML="ğŸ”Š",g.querySelector(".snake-container").appendChild(X);let E=20,P=120,B=1e4,Q=[],v={x:1,y:0},J=null,z={x:0,y:0},h=0,K=null,m=!1,T=!1,w=!0,F=null;function L(){try{return F||(F=new(window.AudioContext||window.webkitAudioContext)),F}catch{return null}}function M(t){if(!w)return;const e=L();if(!e)return;const n=e.createOscillator(),o=e.createGain();n.type="sine",n.frequency.setValueAtTime(600,e.currentTime),n.frequency.exponentialRampToValueAtTime(1200,e.currentTime+.08),o.gain.setValueAtTime(.0001,e.currentTime),o.gain.linearRampToValueAtTime(.12,e.currentTime+.02),o.gain.exponentialRampToValueAtTime(.001,e.currentTime+.18),n.connect(o),o.connect(e.destination),n.start(),n.stop(e.currentTime+.2)}function R(){if(!w)return;const t=L();if(!t)return;const e=t.createOscillator(),n=t.createOscillator(),o=t.createGain();e.type="sawtooth",n.type="sine",e.frequency.setValueAtTime(220,t.currentTime),n.frequency.setValueAtTime(110,t.currentTime),e.frequency.exponentialRampToValueAtTime(80,t.currentTime+.25),n.frequency.exponentialRampToValueAtTime(40,t.currentTime+.25),o.gain.setValueAtTime(.0001,t.currentTime),o.gain.linearRampToValueAtTime(.2,t.currentTime+.01),o.gain.exponentialRampToValueAtTime(.0001,t.currentTime+.35),e.connect(o),n.connect(o),o.connect(t.destination),e.start(),n.start(),e.stop(t.currentTime+.35),n.stop(t.currentTime+.35)}function l(t){navigator.vibrate&&navigator.vibrate(t)}function U(){Q=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],v={x:1,y:0},J=null,h=0,G(),H(),m=!1,T=!1,S.style.display="none",clearInterval(K),K=setInterval(W,P),k()}function H(){z={x:Math.floor(Math.random()*(q.width/E)),y:Math.floor(Math.random()*(q.height/E))},Q.some(t=>t.x===z.x&&t.y===z.y)&&H()}function k(){y.clearRect(0,0,q.width,q.height),y.strokeStyle="rgba(255,255,255,0.04)";for(let t=0;t<q.width;t+=E)y.beginPath(),y.moveTo(t,0),y.lineTo(t,q.height),y.stroke();for(let t=0;t<q.height;t+=E)y.beginPath(),y.moveTo(0,t),y.lineTo(q.width,t),y.stroke();Q.forEach((t,e)=>{y.fillStyle=e===0?"#4CAF50":"#8BC34A",y.fillRect(t.x*E,t.y*E,E,E),y.strokeStyle="#2e7d32",y.strokeRect(t.x*E+1,t.y*E+1,E-2,E-2)}),y.fillStyle="#FF5252",y.beginPath(),y.arc(z.x*E+E/2,z.y*E+E/2,E/2-1,0,Math.PI*2),y.fill(),T&&!m&&(y.fillStyle="rgba(0,0,0,0.55)",y.fillRect(0,0,q.width,q.height),y.fillStyle="#fff",y.font="28px Arial",y.textAlign="center",y.fillText("æš‚åœä¸­",q.width/2,q.height/2)),m&&(y.fillStyle="rgba(0,0,0,0.6)",y.fillRect(0,0,q.width,q.height),y.fillStyle="#fff",y.font="30px Arial",y.textAlign="center",y.fillText("æ¸¸æˆç»“æŸ",q.width/2,q.height/2-10),y.font="18px Arial",y.fillText(`æœ€ç»ˆå¾—åˆ†: ${h}`,q.width/2,q.height/2+20))}function W(){if(T||m)return;J&&!(J.x===-v.x&&J.y===-v.y)&&(v=J),J=null;const t={x:Q[0].x+v.x,y:Q[0].y+v.y};if(t.x<0||t.y<0||t.x>=q.width/E||t.y>=q.height/E||Q.some(e=>e.x===t.x&&e.y===t.y))return m=!0,k(),R(),l(200),!1;Q.unshift(t),t.x===z.x&&t.y===z.y?(d(10),H(),M(),p(t.x,t.y),l(30)):Q.pop(),k()}function d(t){h+=t,G(),I()}function G(){Y.textContent=`å¾—åˆ†: ${h} / ${B}`;try{window.score=h}catch{}}function I(){const t=typeof window.score=="number"?window.score:h;if(t>=B){clearInterval(K),S.style.display="flex";const e=atob("ZmxhZ3t5MHVfaDFkM19zbjFfczByY2V9");A.textContent=e,console.log("%cFlag unlocked!","color:#4caf50;font-weight:bold;")}else console.log("%cå½“å‰åˆ†æ•°ä¸è¶³ä»¥è§£å‡º flagã€‚ï¼ˆéœ€è¦ >= 10000ï¼‰","color:#ff9800;")}function f(){m||(T=!T,k())}function p(t,e){const n=t*E+E/2,o=e*E+E/2,i=[];for(let r=0;r<12;r++)i.push({x:n,y:o,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,life:30+Math.random()*20,size:1+Math.random()*2});const a=setInterval(()=>{i.forEach(r=>{r.x+=r.vx,r.y+=r.vy,r.vx*=.98,r.vy*=.98,r.life--}),i.forEach(r=>{r.life>0&&(y.fillStyle=`rgba(255,230,120,${Math.max(0,r.life/60)})`,y.beginPath(),y.arc(r.x,r.y,r.size,0,Math.PI*2),y.fill())}),i.every(r=>r.life<=0)&&(clearInterval(a),k())},30)}g.addEventListener("keydown",t=>{[37,38,39,40,32,87,65,83,68].includes(t.keyCode)&&t.preventDefault();switch(t.key){case"ArrowUp":case"w":case"W":v.y===0&&(J={x:0,y:-1});break;case"ArrowDown":case"s":case"S":v.y===0&&(J={x:0,y:1});break;case"ArrowLeft":case"a":case"A":v.x===0&&(J={x:-1,y:0});break;case"ArrowRight":case"d":case"D":v.x===0&&(J={x:1,y:0});break;case" ":f();break}});let i=0,a=0,r=0,n=0,o=20;q.addEventListener("touchstart",t=>{if(t.touches&&t.touches.length>0){const e=t.touches[0];i=e.clientX,a=e.clientY,r=i,n=a}},{passive:!0}),q.addEventListener("touchmove",t=>{if(t.touches&&t.touches.length>0){const e=t.touches[0];r=e.clientX,n=e.clientY}},{passive:!0}),q.addEventListener("touchend",t=>{const e=r-i,s=n-a;if(!(Math.abs(e)<o&&Math.abs(s)<o)){if(Math.abs(e)>Math.abs(s))e>0?v.x===0&&(J={x:1,y:0}):v.x===0&&(J={x:-1,y:0});else s>0?v.y===0&&(J={x:0,y:1}):v.y===0&&(J={x:0,y:-1})}}),q.addEventListener("dblclick",f),C.addEventListener("click",()=>{T?f():m?U():U()}),Z.addEventListener("click",f),N.addEventListener("click",U),O.addEventListener("click",()=>{S.style.display="none"}),X.addEventListener("click",()=>{w=!w,X.innerHTML=w?"ğŸ”Š":"ğŸ”ˆ"}),U(),window.checkFlag=I,window.setScore=function(t){typeof t=="number"?(h=t,G(),console.log("%cscore set to "+t,"color:#4caf50;")):console.warn("setScore requires a number")},console.log("%cğŸ§© Snake CTF Challenge","color:#4caf50;font-size:18px;"),console.log("%cæç¤ºï¼šå°è¯•ä¿®æ”¹ score å¹¶æ‰§è¡Œ checkFlag()","color:#ffc107;"),console.log("%cç¤ºä¾‹ï¼š window.score = 10000 ; checkFlag()","color:#90caf9;")})();
